package com.hw.globalcachesdk;import cn.hutool.extra.ssh.JschUtil;import cn.hutool.extra.ssh.Sftp;import com.hw.globalcachesdk.entity.CephConf;import com.hw.globalcachesdk.entity.ClientConf;import com.hw.globalcachesdk.entity.ClusterConf;import com.hw.globalcachesdk.exception.*;import com.hw.globalcachesdk.executor.*;import com.hw.globalcachesdk.pool.SSHSessionPool;import com.hw.globalcachesdk.utils.ApplicationYmlParser;import com.hw.globalcachesdk.utils.Utils;import java.io.File;import java.io.FileWriter;import java.io.IOException;import java.io.InputStream;import java.util.*;/** * Global Cache SDK * @author 章睿彬 */public class GlobalCacheSDK {    private static String scriptsPath = null;    private static GlobalCacheSDK instance = null;    private SSHSessionPool sshSessionPool = null;    private HashMap<String, String> hostname2ipTable = null;    private CommandExecutorFactory commandExecutorFactory = null;    /* ===============================================================会话管理接口===============================================================*/    /**     * 创建一个SSH会话，若未抛出异常则表示执行成功     * 在调用功能接口之前，需要调用该接口创建SSH会话     * 创建SSH会话需要建立SSH连接，该过程较慢，建议在初始化的功能中一次性建立所有连接     *     * @param host     需要创建会话的主机IP     * @param user     需要创建会话的用户名     * @param password 需要创建会话的主机密码     * @param port     需要创建会话的主机端口     * @throws GlobalCacheSDKException 会话创建失败抛出此异常     * @deprecated 注意: 该接口传入密码不安全，建议只在测试接口时调用     */    public static synchronized void createSession(String host, String user, String password, int port) throws GlobalCacheSDKException {        try {            getInstance().sshSessionPool.createSession(host, user, password, port);        } catch (SessionException e) {            throw new GlobalCacheSDKException("会话异常", e);        }    }    /**     * 创建一个SSH会话，若未抛出异常则表示执行成功     * 在调用功能接口之前，需要调用该接口创建SSH会话     * 创建SSH会话需要建立SSH连接，该过程较慢，建议在初始化的功能中一次性建立所有连接     *     * @param host     需要创建会话的主机IP     * @param user     需要创建会话的用户名     * @param privateKeyPath 私钥路径     * @param passphrase 私钥密码     * @param port     需要创建会话的主机端口     * @throws GlobalCacheSDKException 会话创建失败抛出此异常     */    public static synchronized void createSession(String host, String user, String privateKeyPath, byte[] passphrase, int port) throws GlobalCacheSDKException {        try {            getInstance().sshSessionPool.createSession(host, user, privateKeyPath, passphrase, port);        } catch (SessionException e) {            throw new GlobalCacheSDKException("会话异常", e);        }    }    /**     * 判断Session是否存在     *     * @param host session的主机IP     * @param user 用户名称     * @return 是否存在     * @throws GlobalCacheSDKException GlobalCacheSDK对象为空抛出此异常     */    public static boolean isSessionExist(String host, String user) throws GlobalCacheSDKException {        return getInstance().sshSessionPool.isSessionExist(host, user);    }    /**     * 移除一个SSH会话，若未抛出异常则表示执行成功     * 当已不需要一个会话的时候，可以调用该接口移除SSH会话     *     * @param host 需要移除会话的主机IP     * @param user 需要移除会话的用户名     * @throws GlobalCacheSDKException 会话关闭失败/会话不存在抛出此异常     */    public static synchronized void releaseSession(String host, String user) throws GlobalCacheSDKException {        try {            getInstance().sshSessionPool.releaseSession(host, user);        } catch (SessionException e) {            throw new GlobalCacheSDKException("会话异常", e);        }    }    /* ===============================================================信息获取接口===============================================================*/    /**     * 获取节点的内存信息     *     * @param hosts 需要获取主机IP列表     * @return 每个节点内存信息查询结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.MemInfo     */    public synchronized static HashMap<String, CommandExecuteResult> queryMemInfo(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.QUERY_MEM_INFO);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.QUERY_MEM_INFO);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    /**     * 获取节点的CPU信息     *     * @param hosts 需要获取主机IP列表     * @return 每个节点CPU信息查询结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.CpuInfo     */    public synchronized static HashMap<String, CommandExecuteResult> queryCpuInfo(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.QUERY_CPU_INFO);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.QUERY_CPU_INFO);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    /**     * 获取GlobalCache缓存盘信息     *     * @param ceph1host Ceph1节点IP     * @return CLI查询结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.CacheDiskInfo     */    public synchronized static HashMap<String, CommandExecuteResult> queryCacheDiskInfo(String ceph1host) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.QUERY_CACHE_DISK_INFO);        try {            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            if (ceph1host == null) {                ArrayList<String> tmp = getInstance().getCommandExecuteHosts(RegisterExecutor.QUERY_CACHE_DISK_INFO);                ceph1host = tmp.get(0);            }            return getInstance().sshSessionPool.execute(ceph1host, user, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    /**     * 获取集群异常状态信息     *     * @param ceph1host Ceph1节点IP     * @return 集群异常状态信息查询结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.ClusterAlarmInfo     */    public synchronized static HashMap<String, CommandExecuteResult> queryClusterAlarmInfo(String ceph1host) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.QUERY_CLUSTER_ALARM_INFO);        try {            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            if (ceph1host == null) {                ArrayList<String> tmp = getInstance().getCommandExecuteHosts(RegisterExecutor.QUERY_CLUSTER_ALARM_INFO);                ceph1host = tmp.get(0);            }            return getInstance().sshSessionPool.execute(ceph1host, user, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    /**     * 获取节点的磁盘信息     *     * @param hosts 需要获取主机IP列表     * @return 节点磁盘信息查询结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.DiskInfo     */    public synchronized static HashMap<String, CommandExecuteResult> queryDiskInfo(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.QUERY_DISK_INFO);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.QUERY_DISK_INFO);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    /**     * 获取节点的运行时间     *     * @param hosts 需要获取主机IP列表     * @return 每个节点运行时间查询结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.UptimeInfo     */    public synchronized static HashMap<String, CommandExecuteResult> queryUptime(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.QUERY_UPTIME_INFO);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.QUERY_UPTIME_INFO);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }        /**     * 获取集群状态     *     * @param ceph1host Ceph1节点IP     * @return 集群状态查询结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.ClusterStatusInfo     */    public synchronized static HashMap<String, CommandExecuteResult> queryClusterStatusInfo(String ceph1host) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.QUERY_CLUSTER_STATUS_INFO);        try {            if (ceph1host == null) {                ArrayList<String> tmp = getInstance().getCommandExecuteHosts(RegisterExecutor.QUERY_CLUSTER_STATUS_INFO);                ceph1host = tmp.get(0);            }            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            return getInstance().sshSessionPool.execute(ceph1host, user, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    /**     * 获取节点状态     *     * @param ceph1host Ceph1节点IP     * @return 节点状态查询结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.NodeStatusInfo     */    public synchronized static HashMap<String, CommandExecuteResult> queryNodeStatusInfo(String ceph1host) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.QUERY_NODE_STATUS_INFO);        try {            if (ceph1host == null) {                ArrayList<String> tmp = getInstance().getCommandExecuteHosts(RegisterExecutor.QUERY_NODE_STATUS_INFO);                ceph1host = tmp.get(0);            }            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            return getInstance().sshSessionPool.execute(ceph1host, user, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    /**     * 获取节点的磁盘IO信息     *     * @param hosts 需要获取主机IP列表     * @return 每个节点磁盘分区信息查询结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.DiskIoInfo     */    public synchronized static HashMap<String, CommandExecuteResult> queryDiskIoInfo(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.QUERY_DISK_IO_INFO);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.QUERY_DISK_IO_INFO);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    /**     * 获取静态网络信息     *     * @param host 需查询节点IP     * @return 静态网络信息查询结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.DynamicNetInfo     */    public synchronized static HashMap<String, CommandExecuteResult> queryStaticNetInfo(String host) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.QUERY_STATIC_NET_INFO);        try {            if (host == null) {                ArrayList<String> hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.QUERY_STATIC_NET_INFO);                ArrayList<String> users = new ArrayList<>(hosts.size());                String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());                for (String tmp: hosts) {                    users.add(user);                }                return getInstance().sshSessionPool.execute(hosts, users, executor);            } else {                String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());                return getInstance().sshSessionPool.execute(host, user, executor);            }        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    /**     * 获取动态网络信息     *     * @param hosts 需要获取主机IP列表     * @return 动态网络信息查询结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.DynamicNetInfo     */    public synchronized static HashMap<String, CommandExecuteResult> queryDynamicNetInfo(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.QUERY_DYNAMIC_NET_INFO);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.QUERY_DYNAMIC_NET_INFO);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    /**     * 获取节点PT信息     *     * @param ceph1host Ceph1节点IP     * @param nodeId 节点ID     * @return 节点PT信息查询结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.PtInfo     */    public synchronized static HashMap<String, CommandExecuteResult> queryNodePtInfo(String ceph1host, int nodeId) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.QUERY_NODE_PT_INFO);        try {            if (ceph1host == null) {                ArrayList<String> tmp = getInstance().getCommandExecuteHosts(RegisterExecutor.QUERY_NODE_PT_INFO);                ceph1host = tmp.get(0);            }            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            String args = "" + nodeId;            return getInstance().sshSessionPool.execute(ceph1host, user, executor, args);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    /**     * 获取集群PT信息     *     * @param host Ceph1节点IP     * @return 集群PT信息查询结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.PtInfo     */    public synchronized static HashMap<String, CommandExecuteResult> queryAllPtInfo(String ceph1host) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.QUERY_ALL_PT_INFO);        try {            if (ceph1host == null) {                ArrayList<String> tmp = getInstance().getCommandExecuteHosts(RegisterExecutor.QUERY_ALL_PT_INFO);                ceph1host = tmp.get(0);            }            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            return getInstance().sshSessionPool.execute(ceph1host, user, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    /**     * 获取磁盘PT信息     *     * @param host Ceph1节点IP     * @param diskId 磁盘ID     * @return 磁盘PT信息查询结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.PtInfo     */    public synchronized static HashMap<String, CommandExecuteResult> queryDiskPtInfo(String ceph1host, Integer diskId) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.QUERY_DISK_PT_INFO);        try {            if (ceph1host == null) {                ArrayList<String> tmp = getInstance().getCommandExecuteHosts(RegisterExecutor.QUERY_DISK_PT_INFO);                ceph1host = tmp.get(0);            }            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            String args = "" + diskId;            return getInstance().sshSessionPool.execute(ceph1host, user, executor, args);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    /**     * 获取PtIo信息     *     * @param ceph1host Ceph1节点IP     * @return 节点状态查询结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.PtIoInfo     */    public synchronized static HashMap<String, CommandExecuteResult> queryPtIoInfo(String ceph1host) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.QUERY_PT_IO_INFO);        try {            if (ceph1host == null) {                ArrayList<String> tmp = getInstance().getCommandExecuteHosts(RegisterExecutor.QUERY_PT_IO_INFO);                ceph1host = tmp.get(0);            }            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            return getInstance().sshSessionPool.execute(ceph1host, user, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    /**     * 获取节点PG信息     *     * @param ceph1host Ceph1节点IP     * @param nodeId 节点ID     * @return 节点PG信息查询结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.PgInfo     */    public synchronized static HashMap<String, CommandExecuteResult> queryNodePgInfo(String ceph1host, int nodeId) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.QUERY_NODE_PG_INFO);        try {            if (ceph1host == null) {                ArrayList<String> tmp = getInstance().getCommandExecuteHosts(RegisterExecutor.QUERY_NODE_PG_INFO);                ceph1host = tmp.get(0);            }            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            String args = "" + nodeId;            return getInstance().sshSessionPool.execute(ceph1host, user, executor, args);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    /**     * 获取集群PG信息     *     * @param ceph1host Ceph1节点IP     * @return 集群PG信息查询结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.PgInfo     */    public synchronized static HashMap<String, CommandExecuteResult> queryAllPgInfo(String ceph1host) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.QUERY_ALL_PG_INFO);        try {            if (ceph1host == null) {                ArrayList<String> tmp = getInstance().getCommandExecuteHosts(RegisterExecutor.QUERY_ALL_PG_INFO);                ceph1host = tmp.get(0);            }            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            return getInstance().sshSessionPool.execute(ceph1host, user, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    /**     * 获取磁盘PG信息     *     * @param ceph1host Ceph1节点IP     * @param diskId 磁盘ID     * @return 磁盘PG信息查询结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.PgInfo     */    public synchronized static HashMap<String, CommandExecuteResult> queryDiskPgInfo(String ceph1host, Integer diskId) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.QUERY_DISK_PG_INFO);        try {            if (ceph1host == null) {                ArrayList<String> tmp = getInstance().getCommandExecuteHosts(RegisterExecutor.QUERY_DISK_PG_INFO);                ceph1host = tmp.get(0);            }            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            String args = "" + diskId;            return getInstance().sshSessionPool.execute(ceph1host, user, executor, args);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    /**     * 获取节点名称信息     *     * @param host     * @return 节点名称查询结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.HostNameInfo     */    public synchronized static HashMap<String, CommandExecuteResult> queryHostNameInfo(String host) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.QUERY_HOST_NAME_INFO);        try {            if (host == null) {                ArrayList<String> hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.QUERY_HOST_NAME_INFO);                ArrayList<String> users = new ArrayList<>(hosts.size());                String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());                for (String tmp: hosts) {                    users.add(user);                }                return getInstance().sshSessionPool.execute(hosts, users, executor);            } else {                String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());                return getInstance().sshSessionPool.execute(host, user, executor);            }        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    /* ===============================================================环境检查接口===============================================================*/    /**     * Ceph部署检查     *     * @param hosts     * @return Ceph部署检查结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.ErrorCodeEntity     */    public synchronized static HashMap<String, CommandExecuteResult> checkCeph(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.CHECK_CEPH);        try {            if (hosts == null) {               hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.CHECK_CEPH);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> checkCeph() throws GlobalCacheSDKException {        return GlobalCacheSDK.checkCeph(null);    }    /**     * Client节点GlobalCache部署检查     *     * @param hosts     * @return Client节点GlobalCache部署检查结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.ErrorCodeEntity     */    public synchronized static HashMap<String, CommandExecuteResult> checkClient(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.CHECK_CLIENT);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.CHECK_CLIENT);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> checkClient() throws GlobalCacheSDKException {        return GlobalCacheSDK.checkClient(null);    }    /**     * Compile节点依赖包编译检查     *     * @param hosts     * @return Compile节点依赖包编译检查结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.ErrorCodeEntity     */    public synchronized static HashMap<String, CommandExecuteResult> checkCompile(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.CHECK_COMPILE);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.CHECK_COMPILE);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> checkCompile() throws GlobalCacheSDKException {        return GlobalCacheSDK.checkCompile(null);    }    /**     * 节点配置文件检查     *     * @param hosts     * @return 节点配置文件检查结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.ErrorCodeEntity     */    public synchronized static HashMap<String, CommandExecuteResult> checkConf(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.CHECK_CONF);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.CHECK_CONF);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> checkConf() throws GlobalCacheSDKException {        return GlobalCacheSDK.checkConf(null);    }    /**     * 软件包分发检查     *     * @param hosts     * @return 软件包分发检查结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.ErrorCodeEntity     */    public synchronized static HashMap<String, CommandExecuteResult> checkDistribute(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.CHECK_DISTRIBUTE);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.CHECK_DISTRIBUTE);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> checkDistribute() throws GlobalCacheSDKException {        return GlobalCacheSDK.checkDistribute(null);    }    /**     * Server节点GlobalCache部署检查     *     * @param hosts     * @return Server节点GlobalCache部署检查结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.ErrorCodeEntity     */    public synchronized static HashMap<String, CommandExecuteResult> checkServer(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.CHECK_SERVER);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.CHECK_SERVER);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> checkServer() throws GlobalCacheSDKException {        return GlobalCacheSDK.checkServer(null);    }    /**     * 节点硬件检查     *     * @param hosts     * @return 节点硬件检查结果     *         errorCode对应结果：     *             0: 硬件满足部署条件     *             1：内存不满足     *             2：CPU不满足     *             3：均不满足     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.ErrorCodeEntity     */    public synchronized static HashMap<String, CommandExecuteResult> checkHardware(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.CHECK_HARDWARE);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.CHECK_HARDWARE);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> checkHardware() throws GlobalCacheSDKException {        return GlobalCacheSDK.checkHardware(null);    }    /**     * GlobalCache运行检查     *     * @param hosts     * @return GlobalCache运行检查检查结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.ErrorCodeEntity     */    public synchronized static HashMap<String, CommandExecuteResult> checkGlobalCacheRunning(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.CHECK_GLOBAL_CACHE_RUNNING);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.CHECK_GLOBAL_CACHE_RUNNING);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> checkGlobalCacheRunning() throws GlobalCacheSDKException {        return GlobalCacheSDK.checkGlobalCacheRunning(null);    }    /* ===============================================================自动化部署接口===============================================================*/    /**     * 初始化集群配置     *     * @param cephConfs Ceph节点配置信息     * @param clientConfs Client节点配置信息     * @param clusterConf 集群配置信息     * @throws GlobalCacheSDKException 执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.ClientConf     * @see com.hw.globalcachesdk.entity.CephConf     * @see com.hw.globalcachesdk.entity.ClusterConf     */    public synchronized static void initClusterSettings(ArrayList<CephConf> cephConfs, ArrayList<ClientConf> clientConfs, ClusterConf clusterConf) throws GlobalCacheSDKException {        String user = "root";        // 默认所有节点root密码一致        String password = cephConfs.get(0).getRootPasswd();        // sftp连接池        // hostname : sftp connection        HashMap<String, Sftp> sftpPool = new LinkedHashMap<>();        HashMap<String, String> hostname2ipTable = new HashMap<>();        for (CephConf cephConf : cephConfs) {            hostname2ipTable.put(cephConf.getHostname(), cephConf.getRemoteIp());            if (sftpPool.get(cephConf.getHostname()) == null ) {                sftpPool.put(cephConf.getHostname(), JschUtil.createSftp(cephConf.getRemoteIp(), 22, user, password));            }        }        for (ClientConf clientConf : clientConfs) {            hostname2ipTable.put(clientConf.getHostname(), clientConf.getRemoteIp());            if (sftpPool.get(clientConf.getHostname()) == null ) {                sftpPool.put(clientConf.getHostname(), JschUtil.createSftp(clientConf.getRemoteIp(), 22, user, password));            }        }        setHostname2ipTable(hostname2ipTable);        // 将中间数据存放到临时目录        String realPath = "/tmp";        {            // hostnamelist.txt            StringBuilder hostnamelistContent = new StringBuilder("");            for (Map.Entry<String, String> entry : getInstance().hostname2ipTable.entrySet()) {                // ip hostname                hostnamelistContent.append(entry.getValue()).append(" ").append(entry.getKey()).append("\n");            }            try {                File hostnameFile = new File( realPath + "/hostnamelist.txt");                FileWriter fileWriter = new FileWriter(hostnameFile);                fileWriter.write(hostnamelistContent.toString());                fileWriter.close();            } catch (IOException e) {                throw new GlobalCacheSDKException("保存配置文件失败", e);            }            for (Map.Entry<String, Sftp> entry : sftpPool.entrySet()) {                Sftp sftp = entry.getValue();                sftp.cd("/home");                sftp.put(realPath + "/hostnamelist.txt", "/home/hostnamelist.txt");            }        }        {            // nodelist.txt            int ccmMonitorNodeNum = -1;            int zkServerNodeNum = -1;            for (CephConf cephConf : cephConfs) {                if (cephConf.isCcmMonitor()) {                    ccmMonitorNodeNum = cephConf.getNodeNumber();                }                if (cephConf.isZkServer()) {                    zkServerNodeNum = cephConf.getNodeNumber();                }            }            StringBuilder nodelistContent = new StringBuilder("");            for (CephConf cephConf : cephConfs) {                // hostname node_number public_ip public_ip local_ip cluster_ip pt_num pg_num <device1> <device2> zk_server ccm_monitor                nodelistContent.append(cephConf.getHostname()).append(" ")                        .append(cephConf.getNodeNumber()).append(" ")                        .append(cephConf.getRemoteIp()).append(" ")                        .append(cephConf.getPublicIp()).append(" ")                        .append(cephConf.getLocalIp()).append(" ")                        .append(cephConf.getClusterIp()).append(" ")                        .append(clusterConf.getPtNum()).append(" ")                        .append(clusterConf.getPtNum()).append(" ")                        .append("<device>").append(" ")                        .append("<device>").append(" ")                        .append(zkServerNodeNum).append(" ")                        .append(ccmMonitorNodeNum).append("\n");            }            for (Map.Entry<String, Sftp> entry : sftpPool.entrySet()) {                try {                    File hostnameFile = new File(realPath + "/nodelist.txt");                    FileWriter fileWriter = new FileWriter(hostnameFile);                    fileWriter.write(nodelistContent.toString());                    fileWriter.close();                } catch (IOException e) {                    throw new GlobalCacheSDKException("保存配置文件失败", e);                }                Sftp sftp = entry.getValue();                sftp.cd("/home");                sftp.put(realPath + "/nodelist.txt", "/home/nodelist.txt");            }        }        {            // script.conf            String ntpServer = "";            for (CephConf cephConf : cephConfs) {                if (cephConf.isNtpServer()) {                    ntpServer = cephConf.getPublicIp();                }            }            // hostname, script.conf            HashMap<String, String> scriptConfContents = new HashMap<>();            for (CephConf cephConf : cephConfs) {                StringBuilder scriptConfContent = new StringBuilder("");                scriptConfContent.append("hostname: ").append(cephConf.getHostname()).append("\n")                        .append("ip: ").append(cephConf.getPublicIp()).append("\n")                        .append("mask: ").append(cephConf.getNetworkMask()).append("\n")                        .append("public_network: ").append(clusterConf.getPublicNetwork()).append("\n")                        .append("cluster_network: ").append(clusterConf.getClusterNetwork()).append("\n")                        .append("ntp_server: ").append(ntpServer).append("\n")                        .append("password: ").append(cephConf.getRootPasswd()).append("\n");                scriptConfContents.put(cephConf.getHostname(), scriptConfContent.toString());            }            for (ClientConf clientConf : clientConfs) {                StringBuilder scriptConfContent = new StringBuilder("");                scriptConfContent.append("hostname: ").append(clientConf.getHostname()).append("\n")                        .append("ip: ").append(clientConf.getPublicIp()).append("\n")                        .append("mask: ").append(clientConf.getNetworkMask()).append("\n")                        .append("public_network: ").append(clusterConf.getPublicNetwork()).append("\n")                        .append("cluster_network: ").append(clusterConf.getClusterNetwork()).append("\n")                        .append("ntp_server: ").append(ntpServer).append("\n")                        .append("password: ").append(clientConf.getRootPasswd()).append("\n");                scriptConfContents.put(clientConf.getHostname(), scriptConfContent.toString());            }            for (Map.Entry<String, Sftp> entry : sftpPool.entrySet()) {                try {                    File hostnameFile = new File(realPath + "/" + "script_conf_" + entry.getKey() + ".txt");                    FileWriter fileWriter = new FileWriter(hostnameFile);                    fileWriter.write(scriptConfContents.get(entry.getKey()));                    fileWriter.close();                } catch (IOException e) {                    throw new GlobalCacheSDKException("保存配置文件失败", e);                }                Sftp sftp = entry.getValue();                sftp.cd("/home");                sftp.put(realPath + "/" + "script_conf_" + entry.getKey() + ".txt", "/home/script.conf");            }        }        {            // hostname, disklist.txt            HashMap<String, String> disklistContents = new HashMap<>();            // disklist.txt            for (CephConf cephConf : cephConfs) {                StringBuilder disklistContent = new StringBuilder();                for (String dataDisk : cephConf.getDataDiskList()) {                    disklistContent.append(dataDisk).append("\n");                }                for (String cacheDisk : cephConf.getCacheDiskList()) {                    disklistContent.append(cacheDisk).append("\n");                }                disklistContents.put(cephConf.getHostname(), disklistContent.toString());            }            for (Map.Entry<String, Sftp> entry : sftpPool.entrySet()) {                try {                    File disklistFile = new File(realPath + "/disklist_" + entry.getKey() + ".txt");                    FileWriter fileWriter = new FileWriter(disklistFile);                    String disklistContent = disklistContents.get(entry.getKey());                    if (disklistContent == null) {                        continue;                    } else {                        fileWriter.write(disklistContent);                    }                    fileWriter.close();                } catch (IOException e) {                    throw new GlobalCacheSDKException("保存配置文件失败", e);                }                Sftp sftp = entry.getValue();                sftp.cd("/home");                // ceph1: disklist_ceph1.txt -> cephx: disklist.txt                sftp.put(realPath + "/disklist_" + entry.getKey() + ".txt", "/home/disklist.txt");                if (entry.getKey().equals("ceph1")) {                    // only on ceph1 node                    for (String key : sftpPool.keySet()) {                        String srcFilePath = realPath + "/disklist_"+key + ".txt";                        String dstFilePath = "/home/disklist_" + key +".txt";                        try {                            // local: disklist_ceph1.txt -> ceph1: disklist_ceph1.txt                            System.out.println("cp " + srcFilePath + " " + dstFilePath);                            Runtime.getRuntime().exec("cp " + srcFilePath + " " + dstFilePath);                        } catch (IOException e) {                            System.err.println("copy " + srcFilePath + " to " + dstFilePath + " failed!");                            throw new GlobalCacheSDKException("保存配置文件失败", e);                        }                    }                }            }        }    }    /**     * 配置编译节点     *     * @param hosts     * @return 脚本异步执行结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     */    public synchronized static HashMap<String, CommandExecuteResult> compileNodeConfEnv(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.COMPILE_NODE_CONF_ENV);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.COMPILE_NODE_CONF_ENV);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> compileNodeConfEnv() throws GlobalCacheSDKException {        return GlobalCacheSDK.compileNodeConfEnv(null);    }    /**     * client节点安装ceph     *     * @param hosts     * @return 脚本异步执行结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     */    public synchronized static HashMap<String, CommandExecuteResult> clientNodeInstallCeph(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.CLIENT_NODE_INSTALL_CEPH);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.CLIENT_NODE_INSTALL_CEPH);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> clientNodeInstallCeph() throws GlobalCacheSDKException {        return GlobalCacheSDK.clientNodeInstallCeph(null);    }    /**     * 配置GC客户端节点编译环境     *     * @param hosts     * @return 脚本异步执行结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     */    public synchronized static HashMap<String, CommandExecuteResult> clientNodeConfCompileEnv(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.COMPILE_NODE_CONF_ENV);        executor.getDes().setExecuteNode(ExecuteNode.ALL_CLIENT_NODES);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.COMPILE_NODE_CONF_ENV);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> clientNodeConfCompileEnv() throws GlobalCacheSDKException {        return GlobalCacheSDK.clientNodeConfCompileEnv(null);    }    /**     * 客户端编译包     *     * @param hosts     * @return 脚本异步执行结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     */    public synchronized static HashMap<String, CommandExecuteResult> clientNodeBuildPkgs(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.CLIENT_NODE_BUILD_PKGS);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.CLIENT_NODE_BUILD_PKGS);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> clientNodeBuildPkgs() throws GlobalCacheSDKException {        return GlobalCacheSDK.clientNodeBuildPkgs(null);    }    /**     * 编译依赖包     *     * @param hosts     * @return 脚本异步执行结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     */    public synchronized static HashMap<String, CommandExecuteResult> compileNodeBuildPkgs(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.COMPILE_NODE_BUILD_PKGS);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.COMPILE_NODE_BUILD_PKGS);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> compileNodeBuildPkgs() throws GlobalCacheSDKException {        return GlobalCacheSDK.compileNodeBuildPkgs(null);    }    /**     * 分发软件包     *     * @param hosts     * @return 脚本异步执行结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     */    public synchronized static HashMap<String, CommandExecuteResult> compileNodeDistributePkgs(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.COMPILE_NODE_DISTRIBUTE_PKGS);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.COMPILE_NODE_DISTRIBUTE_PKGS);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> compileNodeDistributePkgs() throws GlobalCacheSDKException {        return GlobalCacheSDK.compileNodeDistributePkgs(null);    }    /**     * 配置ceph节点环境     *     * @param hosts     * @return 脚本异步执行结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     */    public synchronized static HashMap<String, CommandExecuteResult> cephNodeConfEnv(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.CEPH_NODE_CONF_ENV);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.CEPH_NODE_CONF_ENV);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> cephNodeConfEnv() throws GlobalCacheSDKException {        return GlobalCacheSDK.cephNodeConfEnv(null);    }    /**     * NTP服务端环境配置     *     * @param hosts     * @return 脚本异步执行结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     */    public synchronized static HashMap<String, CommandExecuteResult> ntpServerNodeConfEnv(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.NTP_SERVER_NODE_CONF_ENV);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.NTP_SERVER_NODE_CONF_ENV);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> ntpServerNodeConfEnv() throws GlobalCacheSDKException {        return GlobalCacheSDK.ntpServerNodeConfEnv(null);    }    /**     * NTP客户端环境配置     *     * @param hosts     * @return 脚本异步执行结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     */    public synchronized static HashMap<String, CommandExecuteResult> ntpClientNodeConfEnv(ArrayList<String> hosts) throws GlobalCacheSDKException{        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.NTP_CLIENT_NODE_CONF_ENV);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.NTP_CLIENT_NODE_CONF_ENV);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> ntpClientNodeConfEnv() throws GlobalCacheSDKException {        return GlobalCacheSDK.ntpClientNodeConfEnv(null);    }    /**     * 格式化磁盘     *     * @param hosts     * @return 脚本异步执行结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     */    public synchronized static HashMap<String, CommandExecuteResult> cephNodeDiskPartition(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.CEPH_NODE_DISK_PARTITION);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.CEPH_NODE_DISK_PARTITION);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> cephNodeDiskPartition() throws GlobalCacheSDKException {        return GlobalCacheSDK.cephNodeDiskPartition(null);    }    /**     * 清理OSD     *     * @param hosts     * @return 脚本异步执行结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     */    public synchronized static HashMap<String, CommandExecuteResult> ceph1NodeCleanOsd(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.CEPH1_NODE_CLEAN_OSD);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.CEPH1_NODE_CLEAN_OSD);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> ceph1NodeCleanOsd() throws GlobalCacheSDKException {        return GlobalCacheSDK.ceph1NodeCleanOsd(null);    }    /**     * 部署Ceph     *     * @param hosts     * @return 脚本异步执行结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     */    public synchronized static HashMap<String, CommandExecuteResult> ceph1NodeDeployCeph(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.CEPH1_NODE_DEPLOY_CEPH);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.CEPH1_NODE_DEPLOY_CEPH);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> ceph1NodeDeployCeph() throws GlobalCacheSDKException {        return GlobalCacheSDK.ceph1NodeDeployCeph(null);    }    /**     * 配置GC服务端节点环境     *     * @param hosts     * @return 脚本异步执行结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     */    public synchronized static HashMap<String, CommandExecuteResult> serverNodeConfEnv(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.SERVER_NODE_CONF_ENV);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.SERVER_NODE_CONF_ENV);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> serverNodeConfEnv() throws GlobalCacheSDKException {        return GlobalCacheSDK.serverNodeConfEnv(null);    }    /**     * 配置GC客户端节点环境     *     * @param hosts     * @return 脚本异步执行结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     */    public synchronized static HashMap<String, CommandExecuteResult> clientNodeConfEnv(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.CLIENT_NODE_CONF_ENV);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.CLIENT_NODE_CONF_ENV);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> clientNodeConfEnv() throws GlobalCacheSDKException {        return GlobalCacheSDK.clientNodeConfEnv(null);    }    /**     * server节点安装软件包     *     * @param hosts     * @return 脚本异步执行结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     */    public synchronized static HashMap<String, CommandExecuteResult> serverNodeInstallPkgs(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.SERVER_NODE_INSTALL_PKGS);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.SERVER_NODE_INSTALL_PKGS);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> serverNodeInstallPkgs() throws GlobalCacheSDKException {        return GlobalCacheSDK.serverNodeInstallPkgs(null);    }    /**     * client节点安装软件包     *     * @param hosts     * @return 脚本异步执行结果     * @throws GlobalCacheSDKException 执行失败抛出此异常     */    public synchronized static HashMap<String, CommandExecuteResult> clientNodeInstallPkgs(ArrayList<String> hosts) throws GlobalCacheSDKException {        AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.CLIENT_NODE_INSTALL_PKGS);        try {            if (hosts == null) {                hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.CLIENT_NODE_INSTALL_PKGS);            }            ArrayList<String> users = new ArrayList<>(hosts.size());            String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());            for (String host : hosts) {                users.add(user);            }            return getInstance().sshSessionPool.execute(hosts, users, executor);        } catch (SSHSessionPoolException e) {            throw new GlobalCacheSDKException("SSH会话池异常", e);        }    }    @Deprecated    public synchronized static HashMap<String, CommandExecuteResult> clientNodeInstallPkgs() throws GlobalCacheSDKException {        return GlobalCacheSDK.clientNodeInstallPkgs(null);    }    /**     * 控制GlobalCache服务     * 注意: 该命令需要ROOT权限才能执行     *     * @param hosts 主机IP列表     * @param op 操作，说明如下：     *           start: 第一次启动GlobalCache服务     *           restart: 重启GlobalCache服务（也可用作开启GlobalCache服务）     *           stop: 停止GlobalCache服务     *           clean: 清理zookeeper     *           init: bdm初始化     * @return 每个节点命令执行错误码, 错误码不为0表示执行失败     * @throws GlobalCacheSDKException op不支持/执行失败抛出此异常     * @see com.hw.globalcachesdk.entity.ErrorCodeEntity     */    public synchronized static HashMap<String, CommandExecuteResult> gcServiceControl(ArrayList<String> hosts, String op) throws GlobalCacheSDKException {        switch (op) {            case "start":            case "restart":            case "stop":            case "clean":            case "init":                AbstractCommandExecutor executor = getInstance().commandExecutorFactory.getCommandExecutor(RegisterExecutor.GLOBAL_CACHE_SERVICE_CONTROL);                try {                    if (hosts == null) {                        hosts = getInstance().getCommandExecuteHosts(RegisterExecutor.GLOBAL_CACHE_SERVICE_CONTROL);                    }                    ArrayList<String> args = new ArrayList<>(hosts.size());                    ArrayList<String> users = new ArrayList<>(hosts.size());                    String user = Utils.enumExecutePrivilegeName(executor.getDes().getExecutePrivilege());                    for (String host : hosts) {                        args.add(op);                        users.add(user);                    }                    return getInstance().sshSessionPool.execute(hosts, users, executor, args);                } catch (SSHSessionPoolException e) {                    throw new GlobalCacheSDKException("SSH会话池异常", e);                }            default:                throw new GlobalCacheSDKException("不支持的操作");        }    }    /* ===============================================================辅助配置接口===============================================================*/    public static synchronized void setHostname2ipTable(HashMap<String, String> hostname2IpTable) throws GlobalCacheSDKException {        getInstance().hostname2ipTable = hostname2IpTable;    }    /**     * 设置当前命令的请求超时时间     *     * @param registerExecutor 命令枚举     * @param timeout 超时时间 单位: 秒     *                注意：超时时间必须大于0, 且为整数     * @throws GlobalCacheSDKException 当命令未注册时抛出此异常     */    public synchronized static void setCommandTimeout(RegisterExecutor registerExecutor, int timeout) throws GlobalCacheSDKException {        if (timeout <= 0) {            throw new GlobalCacheSDKException("超时时间必须大于0");        }        CommandExecutorFactory commandExecutorFactory = getInstance().commandExecutorFactory;        if (null == commandExecutorFactory.getCommandExecutor(registerExecutor)) {            throw new GlobalCacheSDKException("命令未注册");        }        commandExecutorFactory.getCommandExecutor(registerExecutor).getDes().setTimeout(timeout);    }    public synchronized static int getCommandTimeout(RegisterExecutor registerExecutor) throws GlobalCacheSDKException {        CommandExecutorFactory commandExecutorFactory = getInstance().commandExecutorFactory;        if (null == commandExecutorFactory.getCommandExecutor(registerExecutor)) {            throw new GlobalCacheSDKException("命令未注册");        }        return commandExecutorFactory.getCommandExecutor(registerExecutor).getDes().getTimeout();    }    /**     * 获取命令执行接口类型     * 可以使用该接口确定调用该接口需要传入哪些hosts     *     * @param registerExecutor 命令枚举     * @return 命令需要执行的节点枚举     * @throws GlobalCacheSDKException 当命令未注册时抛出此异常     */    public static ExecuteNode getCommandExecuteNode(RegisterExecutor registerExecutor) throws GlobalCacheSDKException {        CommandExecutorFactory commandExecutorFactory = getInstance().commandExecutorFactory;        if (null == commandExecutorFactory.getCommandExecutor(registerExecutor)) {            throw new GlobalCacheSDKException("命令未注册");        }        return commandExecutorFactory.getCommandExecutor(registerExecutor).getDes().getExecuteNode();    }    public static void setCommandExecuteNode(RegisterExecutor registerExecutor, ExecuteNode executeNode) throws GlobalCacheSDKException {        CommandExecutorFactory commandExecutorFactory = getInstance().commandExecutorFactory;        if (null == commandExecutorFactory.getCommandExecutor(registerExecutor)) {            throw new GlobalCacheSDKException("命令未注册");        }        commandExecutorFactory.getCommandExecutor(registerExecutor).getDes().setExecuteNode(executeNode);    }    public static ExecutePrivilege getCommandExecutePrivilege(RegisterExecutor registerExecutor) throws GlobalCacheSDKException {        CommandExecutorFactory commandExecutorFactory = getInstance().commandExecutorFactory;        if (null == commandExecutorFactory.getCommandExecutor(registerExecutor)) {            throw new GlobalCacheSDKException("命令未注册");        }        return commandExecutorFactory.getCommandExecutor(registerExecutor).getDes().getExecutePrivilege();    }    public static void setCommandExecuteNode(RegisterExecutor registerExecutor, ExecutePrivilege executePrivilege) throws GlobalCacheSDKException {        CommandExecutorFactory commandExecutorFactory = getInstance().commandExecutorFactory;        if (null == commandExecutorFactory.getCommandExecutor(registerExecutor)) {            throw new GlobalCacheSDKException("命令未注册");        }        commandExecutorFactory.getCommandExecutor(registerExecutor).getDes().setExecutePrivilege(executePrivilege);    }    /**     * 获取脚本根路径     *     * @return 脚本根路径     */    public static String getScriptsPath() {        if (null == instance) {            try {                instance = new GlobalCacheSDK();            } catch (GlobalCacheSDKException e) {                return null;            }        }        return scriptsPath;    }    /**     * 设置脚本根路径     *     * @param path 脚本路径     */    public static boolean setScriptsPath(String path) {        if (null == instance) {            try {                instance = new GlobalCacheSDK();            } catch (GlobalCacheSDKException e) {                return false;            }        }        GlobalCacheSDK.scriptsPath = path;        return true;    }    /* ===============================================================私有方法===============================================================*/    private static synchronized GlobalCacheSDK getInstance() throws GlobalCacheSDKException {        if (null == instance) {            instance = new GlobalCacheSDK();        }        return instance;    }    private GlobalCacheSDK() throws GlobalCacheSDKException {        try {            InputStream inputStream = this.getClass().getResourceAsStream("/application.yml");            Map<String, Object> applicationProperties = ApplicationYmlParser.parse(inputStream);            scriptsPath = (String) applicationProperties.get("GlobalCacheScripts.path");        } catch (ApplicationYmlParserException e) {            throw new GlobalCacheSDKException("配置文件", e);        }        hostname2ipTable = new LinkedHashMap<>();        sshSessionPool = new SSHSessionPool();        try {            commandExecutorFactory = new CommandExecutorFactory();        } catch (CommandExecutorFactoryException e) {            throw new GlobalCacheSDKException("命令注册失败", e);        }    }    private ArrayList<String> getCommandExecuteHosts(RegisterExecutor registerExecutor) throws GlobalCacheSDKException {        ExecuteNode executeNode = getCommandExecuteNode(registerExecutor);        ArrayList<String> hosts = new ArrayList<>();        if (hostname2ipTable == null || hostname2ipTable.isEmpty()) {            throw new GlobalCacheSDKException("节点名-IP 转换表为空，请先调用setHostname2IpTable进行初始化");        }        switch (executeNode) {            case ALL_NODES:                for (Map.Entry<String, String> entry : hostname2ipTable.entrySet()) {                    hosts.add(entry.getValue());                }                return hosts;            case ANY_NODES:                for (Map.Entry<String, String> entry :hostname2ipTable.entrySet()) {                    hosts.add(entry.getValue());                    break;                }                return hosts;            case ALL_CEPH_NODES:                for (Map.Entry<String, String> entry : hostname2ipTable.entrySet()) {                    if (entry.getKey().contains("ceph")) {                        hosts.add(entry.getValue());                    }                }                return hosts;            case ALL_CLIENT_NODES:                for (Map.Entry<String, String> entry : hostname2ipTable.entrySet()) {                    if (entry.getKey().contains("client")) {                        hosts.add(entry.getValue());                    }                }                return hosts;            case ANY_CEPH_NODES:                for (Map.Entry<String, String> entry : hostname2ipTable.entrySet()) {                    if (entry.getKey().contains("ceph")) {                        hosts.add(entry.getValue());                        break;                    }                }                return hosts;            case ANY_CLIENT_NODES:                for (Map.Entry<String, String> entry : hostname2ipTable.entrySet()) {                    if (entry.getKey().contains("client")) {                        hosts.add(entry.getValue());                        break;                    }                }                return hosts;            case CEPH1_ONLY:                String host = hostname2ipTable.get("ceph1");                if (host == null) {                    throw new GlobalCacheSDKException("Ceph1节点不存在");                }                hosts.add(host);                return hosts;            case EX_CEPH1:                for (Map.Entry<String, String> entry : hostname2ipTable.entrySet()) {                    if (!entry.getKey().contains("ceph1")) {                        hosts.add(entry.getValue());                    }                }                return hosts;            default:                throw new GlobalCacheSDKException("不支持的执行节点");        }    }}